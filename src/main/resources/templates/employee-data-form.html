<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Employee Contract - MaxAB HR ERP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/employee-data-form.css}">
    
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <div class="logo-container">
                <div class="logo-placeholder">
                   <img src="/images/MaxAB.webp" alt="MaxAB Logo" class="logo-img">
                </div>
            </div>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-tachometer-alt me-1"></i> Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/employee-data-form"><i class="fas fa-file-contract me-1"></i> Contracts</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/view-employees"><i class="fas fa-users me-1"></i> Employees</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container form-container">
        <div class="form-card">
            <div class="form-header">
                <h1 class="h3 mb-1">Create Employee Contract</h1>
                <p class="mb-0 opacity-75">Fill in the employee details to generate a professional contract</p>
            </div>
            
            <div class="form-body">
                <!-- Dynamic Progress Indicator -->
                <div class="progress-container">
                    <div class="progress">
                        <div class="progress-bar bg-primary" role="progressbar" 
                             id="progressBar" style="width: 0%;" 
                             aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                        </div>
                    </div>
                    <div class="step-indicator">
                        <div class="step active clickable" id="step1" data-section="contract">Contract Details</div>
                        <div class="step clickable" id="step2" data-section="company">Company Information</div>
                        <div class="step clickable" id="step3" data-section="employee">Employee Information</div>
                        <div class="step clickable" id="step4" data-section="salary">Salary Details</div>
                        <div class="step clickable" id="step5" data-section="review">Review & Submit</div>
                    </div>
                </div>
                
                <!-- Simple form without Thymeleaf binding issues -->
               <form id="contractForm" method="POST" action="/save-and-view-employee" 
      enctype="multipart/form-data" onsubmit="handleFormSubmit(event)">
                    
                    <!-- Contract Dates Section -->
                    <div class="form-section" id="contract">
                        <h4 class="section-title"><i class="fas fa-calendar-alt"></i> Contract Dates</h4>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="startDate" class="form-label required-field">Start Date</label>
                                <input type="date" class="form-control progress-field" id="startDate" name="startDate" required />
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="endDate" class="form-label required-field">End Date</label>
                                <input type="date" class="form-control progress-field" id="endDate" name="endDate" required />
                            </div>
                        </div>
                    </div>

                    <!-- Company Information Section -->
                    <div class="form-section" id="company">
                        <h4 class="section-title">
                            <i class="fas fa-building"></i> Company Information
                        </h4>
                        
                        <div class="language-tabs">
                            <div class="language-tab active" data-target="english-company">English</div>
                            <div class="language-tab" data-target="arabic-company">Arabic</div>
                        </div>
                        
                        <div class="language-content active" id="english-company">
                            <div class="row">
                                <div class="col-md-12 mb-3">
                                    <label for="companyNameInEnglish" class="form-label required-field">Company Name (English)</label>
                                    <input type="text" class="form-control progress-field" id="companyNameInEnglish" name="companyNameInEnglish" placeholder="Enter company name in English" required />
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="companyInsuranceNumber" class="form-label">Company Insurance Number</label>
                                    <input type="text" class="form-control" name="companyInsuranceNumber" placeholder="Enter company insurance number" />
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="companyTaxNumber" class="form-label">Company Tax Number</label>
                                    <input type="text" class="form-control" name="companyTaxNumber" placeholder="Enter company tax number" />
                                </div>
                            </div>
                        </div>
                        
                        <div class="language-content" id="arabic-company">
                            <div class="row">
                                <div class="col-md-12 mb-3">
                                    <label for="companyNameInArabic" class="form-label">Company Name (Arabic)</label>
                                    <input type="text" class="form-control" id="companyNameInArabic" name="companyNameInArabic" placeholder="أدخل اسم الشركة بالعربية" dir="rtl" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Employee Details Section -->
                    <div class="form-section" id="employee">
                        <h4 class="section-title">
                            <i class="fas fa-user-tie"></i> Employee Details
                        </h4>

                        <!-- Modern Photo Upload -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="modern-photo-upload">
                                    <div class="upload-header">
                                        <h6><i class="fas fa-camera me-2"></i>Employee Photo</h6>
                                        <small class="text-muted">Upload a professional photo (JPG, PNG, max 5MB)</small>
                                    </div>
                                    <div class="upload-area" id="uploadArea">
                                        <div class="upload-placeholder">
                                            <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                            <p class="mb-2">Drag & drop your photo here</p>
                                            <small class="text-muted">or click to browse</small>
                                        </div>
                                        <div class="upload-preview d-none">
                                            <img id="photoPreview" src="" alt="Employee Photo Preview" class="preview-image">
                                            <div class="preview-overlay">
                                                <button type="button" class="btn btn-light btn-sm" onclick="changePhoto()">
                                                    <i class="fas fa-sync-alt"></i>
                                                </button>
                                                <button type="button" class="btn btn-light btn-sm" onclick="removePhoto()">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <input type="file" id="employeePhoto" name="employeePhotoFile" accept="image/*" class="d-none" />
                                    </div>
                                    <div class="upload-info">
                                        <small class="text-muted">
                                            <i class="fas fa-info-circle me-1"></i>
                                            Recommended: Square photo, 200x200 pixels minimum
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Global Translation Controls -->
                        <div class="translation-controls mb-4">
                            <div class="card bg-light border-0">
                                <div class="card-body py-3">
                                    <div class="row align-items-center">
                                        <div class="col-md-6">
                                            <div class="form-check form-switch mb-0">
                                                <input class="form-check-input" type="checkbox" id="autoTranslateToggle" style="transform: scale(1.2);">
                                                <label class="form-check-label fw-medium" for="autoTranslateToggle">
                                                    <i class="fas fa-bolt text-warning me-2"></i>Auto-translate to Arabic
                                                </label>
                                            </div>
                                            <small class="text-muted">Arabic fields will update automatically as you type</small>
                                        </div>
                                        <div class="col-md-6 text-end">
                                            <button type="button" class="btn btn-outline-success btn-sm" id="translateAllBtn">
                                                <i class="fas fa-language me-1"></i>Translate All Now
                                            </button>
                                            <small class="text-muted d-block mt-1">Translate all English fields at once</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="language-tabs">
                            <div class="language-tab active" data-target="english-employee">English</div>
                            <div class="language-tab" data-target="arabic-employee">Arabic</div>
                        </div>
                        
                        <div class="language-content active" id="english-employee">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="employeeNameInEnglish" class="form-label required-field">
                                        Full Name (English)
                                        <i class="fas fa-language text-info ms-1 small" title="Will be auto-translated to Arabic"></i>
                                    </label>
                                    <input type="text" class="form-control english-field progress-field" id="employeeNameInEnglish" 
                                           name="employeeNameInEnglish" required 
                                           placeholder="Enter employee's full name in English" />
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="titleInEnglish" class="form-label required-field">
                                        Job Title (English)
                                        <i class="fas fa-language text-info ms-1 small" title="Will be auto-translated to Arabic"></i>
                                    </label>
                                    <input type="text" class="form-control english-field progress-field" id="titleInEnglish" 
                                           name="titleInEnglish" required 
                                           placeholder="Enter job title in English" />
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="jobTitleCode" class="form-label">Job Title Code</label>
                                    <input type="text" class="form-control" name="jobTitleCode" placeholder="Enter job title code" />
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="educationInEnglish" class="form-label">
                                        Education (English)
                                        <i class="fas fa-language text-info ms-1 small" title="Will be auto-translated to Arabic"></i>
                                    </label>
                                    <input type="text" class="form-control english-field" id="educationInEnglish" 
                                           name="educationInEnglish" 
                                           placeholder="Enter education details in English" />
                                </div>
                                <div class="col-12 mb-3">
                                    <label for="addressInEnglish" class="form-label">
                                        Address (English)
                                        <i class="fas fa-language text-info ms-1 small" title="Will be auto-translated to Arabic"></i>
                                    </label>
                                    <textarea class="form-control english-field" id="addressInEnglish" 
                                              name="addressInEnglish" rows="2" 
                                              placeholder="Enter address in English"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="language-content" id="arabic-employee">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="employeeNameInArabic" class="form-label">
                                        Full Name (Arabic)
                                        <i class="fas fa-magic text-success ms-1 small" title="Auto-translated field"></i>
                                    </label>
                                    <input type="text" class="form-control arabic-field" id="employeeNameInArabic" 
                                           name="employeeNameInArabic" 
                                           placeholder="سيتم تعبئته تلقائياً" dir="rtl" />
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="titleInArabic" class="form-label">
                                        Job Title (Arabic)
                                        <i class="fas fa-magic text-success ms-1 small" title="Auto-translated field"></i>
                                    </label>
                                    <input type="text" class="form-control arabic-field" id="titleInArabic" 
                                           name="titleInArabic" 
                                           placeholder="سيتم تعبئته تلقائياً" dir="rtl" />
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="educationInArabic" class="form-label">
                                        Education (Arabic)
                                        <i class="fas fa-magic text-success ms-1 small" title="Auto-translated field"></i>
                                    </label>
                                    <input type="text" class="form-control arabic-field" id="educationInArabic" 
                                           name="educationInArabic" 
                                           placeholder="سيتم تعبئته تلقائياً" dir="rtl" />
                                </div>
                                <div class="col-12 mb-3">
                                    <label for="addressInArabic" class="form-label">
                                        Address (Arabic)
                                        <i class="fas fa-magic text-success ms-1 small" title="Auto-translated field"></i>
                                    </label>
                                    <textarea class="form-control arabic-field" id="addressInArabic" 
                                              name="addressInArabic" rows="2" 
                                              placeholder="سيتم تعبئته تلقائياً" dir="rtl"></textarea>
                                </div>
                            </div>
                            
                            <!-- Manual Edit Notice -->
                            <div class="alert alert-info mt-3">
                                <div class="d-flex">
                                    <i class="fas fa-info-circle me-2 mt-1"></i>
                                    <div>
                                        <small>Arabic fields are automatically translated. You can manually edit them if needed. The translation icon <i class="fas fa-language text-info"></i> indicates fields that will be translated.</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-md-6 mb-3">
                                <label for="nationalId" class="form-label required-field">National ID</label>
                                <input type="text" class="form-control progress-field" id="nationalId" name="nationalId" required placeholder="Enter national ID number" />
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="insuranceNumber" class="form-label">Insurance Number</label>
                                <input type="text" class="form-control" name="insuranceNumber" placeholder="Enter insurance number" />
                            </div>
                        </div>
                    </div>

                <!-- Salary Information Section - REFINED -->
<div class="form-section" id="salary">
    <h4 class="section-title">
        <i class="fas fa-money-bill-wave"></i> Salary Information
    </h4>
    
    <div class="language-tabs">
        <div class="language-tab active" data-target="english-salary">English</div>
        <div class="language-tab" data-target="arabic-salary">Arabic</div>
    </div>
    
    <!-- English Salary Content -->
    <div class="language-content active" id="english-salary">
        <!-- Salary Conversion Section -->
        <div class="salary-conversion-card">
            <h6 class="mb-3">Salary Conversion</h6>
            
                     
            <!-- Conversion Toggle -->
            <div class="conversion-toggle">
                <div class="conversion-option active" data-type="gross-to-net">
                    <i class="fas fa-arrow-down me-2"></i>Gross to Net
                </div>
                <div class="conversion-option" data-type="net-to-gross">
                    <i class="fas fa-arrow-up me-2"></i>Net to Gross
                </div>
            </div>
            
            <!-- Gross to Net Conversion -->
            <div class="conversion-content" id="gross-to-net-content">
                <div class="salary-input-group">
                    <label class="form-label required-field">Gross Salary (Number)</label>
                    <input type="number" class="form-control salary-input" id="grossSalary" 
                           placeholder="Enter gross salary amount" step="0.01" />
                    <div class="form-text">Total salary before deductions</div>
                </div>
                
                <div class="conversion-arrow">
                    <i class="fas fa-arrow-down"></i>
                </div>
                
                <div class="salary-result-card">
                    <div class="salary-label">Net Salary</div>
                    <div class="salary-amount" id="netSalaryAmount">0.00</div>
                    <div class="salary-label">After all deductions</div>
                </div>
            </div>
            
            <!-- Net to Gross Conversion -->
            <div class="conversion-content d-none" id="net-to-gross-content">
                <div class="salary-input-group">
                    <label class="form-label required-field">Net Salary (Number)</label>
                    <input type="number" class="form-control salary-input" id="netSalaryInput" 
                           placeholder="Enter net salary amount" step="0.01" />
                    <div class="form-text">Salary after all deductions</div>
                </div>
                
                <div class="conversion-arrow">
                    <i class="fas fa-arrow-up"></i>
                </div>
                
                <div class="salary-result-card">
                    <div class="salary-label">Gross Salary</div>
                    <div class="salary-amount" id="grossSalaryAmount">0.00</div>
                    <div class="salary-label">Before all deductions</div>
                </div>
            </div>

            <!-- Contribution Salary (SHARED - Above both sections) -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <label for="contributionSalary" class="form-label required-field">Contribution Salary</label>
                    <input type="number" class="form-control progress-field" id="contributionSalary" 
                           name="contributionSalary" required 
                           placeholder="Auto-calculated from gross salary" step="0.01" aria-required="true" />
                    <div class="form-text">
                        <small id="contributionHelp" class="text-muted">
                            Auto-calculated: Same as gross salary if &lt; 14,500, otherwise 14,500
                        </small>
                    </div>
                </div>
            </div>
   
            
            <!-- Gross Salary in Words -->
            <div class="row mt-4">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Gross Salary in English Words</label>
                    <input type="text" class="form-control" id="salaryInEnglishText" 
                           name="salaryInEnglishText" 
                           placeholder="Will be auto-generated" readonly />
                </div>
            </div>
        </div>
        
        <!-- Loading and Error Messages -->
        <div class="row mt-3">
            <div class="col-12">
                <div class="alert alert-info d-none" id="salaryCalculatingAlert">
                    <i class="fas fa-spinner fa-spin me-2"></i> Calculating salary...
                </div>
                <div class="alert alert-danger d-none" id="salaryErrorAlert">
                    <i class="fas fa-exclamation-triangle me-2"></i> 
                    <span id="salaryErrorMessage"></span>
                </div>
            </div>
        </div>
        
        <!-- Variable Salary - English -->
        <div class="row mt-4">
            <div class="col-12">
                <h6 class="border-bottom pb-2 mb-3">Variable Salary</h6>
            </div>
            <div class="col-md-4 mb-3">
                <label for="variableSalaryInNumber" class="form-label">Variable Salary (Number)</label>
                <input type="number" class="form-control progress-field salary-input" id="variableSalaryInNumber" 
                       name="variableSalaryInNumber"
                       placeholder="Enter amount" step="0.01" />
                <div class="form-text">Enter numeric amount (e.g., 2,000)</div>
            </div>
            <div class="col-md-4 mb-3">
                <label for="variableSalaryInEnglishText" class="form-label">Variable Salary (English Text)</label>
                <input type="text" class="form-control" id="variableSalaryInEnglishText" 
                       name="variableSalaryInEnglishText"
                       placeholder="Will be auto-generated" readonly />
                <div class="form-text">Auto-generated in English words</div>
            </div>
        </div>
    </div>
    
    <!-- Arabic Salary Content -->
    <div class="language-content" id="arabic-salary">
        <div class="row">
            <div class="col-md-12 mb-3">
                <label class="form-label">Gross Salary in Arabic Words</label>
                <input type="text" class="form-control" id="salaryInArabicTextDisplay" 
                       name="salaryInArabicTextDisplay" 
                       placeholder="سيتم توليده تلقائياً" dir="rtl" readonly />
                <div class="form-text text-end">سيتم توليد النص تلقائياً باللغة العربية</div>
            </div>
        </div>
        
        <!-- Variable Salary - Arabic -->
        <div class="row mt-4">
            <div class="col-12">
                <h6 class="border-bottom pb-2 mb-3 text-end">Variable Salary</h6>
            </div>
            <div class="col-md-12 mb-3">
                <label for="variableSalaryInArabicText" class="form-label">Variable Salary (English Text)</label>
                <input type="text" class="form-control" id="variableSalaryInArabicText" 
                       name="variableSalaryInArabicText"
                       placeholder="سيتم توليده تلقائياً" dir="rtl" readonly />
                <div class="form-text text-end">سيتم توليد النص تلقائياً باللغة العربية</div>
            </div>
        </div>
    </div>
</div>
                    <!-- Review & Submit Section -->
                    <div class="form-section" id="review">
                        <h4 class="section-title">
                            <i class="fas fa-check-circle"></i> Review & Submit
                        </h4>
                        <div class="alert alert-info">
                            <h6><i class="fas fa-info-circle me-2"></i>Review your information</h6>
                            <p class="mb-0">Please review all the information you've entered before submitting the contract.</p>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="d-flex justify-content-between mt-5">
                        <a href="/" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i> Back to Dashboard
                        </a>
                        <div>
                            <button type="submit" class="btn btn-save">
                                <i class="fas fa-save me-2"></i> Save and View
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/translation.js"></script>
    <script src="/js/salary-conversion.js"></script>
    <script src="/js/employee-data-form.js"></script>
    <script src="/js/number-to-text.js"></script>
    
</body>
    
   </html>